<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
        :root {
            color-scheme: light dark;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: light-dark(#1d1d1f, #f5f5f7);
            background-color: light-dark(#ffffff, #1c1c1e);
            padding: 16px;
            margin: 0;
            word-wrap: break-word;
            -webkit-text-size-adjust: 100%;
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            margin-top: 1.4em;
            margin-bottom: 0.6em;
        }

        h1 { font-size: 1.8em; border-bottom: 1px solid light-dark(#d1d1d6, #38383a); padding-bottom: 0.3em; }
        h2 { font-size: 1.5em; border-bottom: 1px solid light-dark(#d1d1d6, #38383a); padding-bottom: 0.3em; }
        h3 { font-size: 1.25em; }

        a {
            color: light-dark(#007aff, #0a84ff);
        }

        code {
            font-family: "SF Mono", Menlo, monospace;
            font-size: 0.9em;
            background-color: light-dark(#f2f2f7, #2c2c2e);
            padding: 0.2em 0.4em;
            border-radius: 4px;
        }

        pre {
            background-color: light-dark(#f2f2f7, #2c2c2e);
            padding: 12px 16px;
            border-radius: 8px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        pre code {
            background: none;
            padding: 0;
            font-size: 0.85em;
        }

        blockquote {
            border-left: 4px solid light-dark(#007aff, #0a84ff);
            margin-left: 0;
            padding-left: 16px;
            color: light-dark(#636366, #aeaeb2);
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }

        th, td {
            border: 1px solid light-dark(#d1d1d6, #38383a);
            padding: 8px 12px;
            text-align: left;
        }

        th {
            background-color: light-dark(#f2f2f7, #2c2c2e);
            font-weight: 600;
        }

        hr {
            border: none;
            border-top: 1px solid light-dark(#d1d1d6, #38383a);
            margin: 2em 0;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        .mermaid {
            text-align: center;
            margin: 1em 0;
        }

        .offline-message {
            color: light-dark(#636366, #aeaeb2);
            font-style: italic;
            text-align: center;
            padding: 2em;
        }
    </style>
</head>
<body>
    <div id="content"></div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

    <script>
        var scriptsLoaded = (typeof marked !== 'undefined');
        var mermaidLoaded = (typeof mermaid !== 'undefined');

        if (mermaidLoaded) {
            var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            mermaid.initialize({
                startOnLoad: false,
                theme: prefersDark ? 'dark' : 'default',
                securityLevel: 'loose'
            });

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                mermaid.initialize({
                    startOnLoad: false,
                    theme: e.matches ? 'dark' : 'default',
                    securityLevel: 'loose'
                });
            });
        }

        function renderMarkdown(text) {
            var contentEl = document.getElementById('content');

            if (!scriptsLoaded) {
                contentEl.innerHTML = '<div class="offline-message">Markdown preview requires an internet connection to load rendering libraries.</div><pre>' + escapeHtml(text) + '</pre>';
                return;
            }

            var renderer = new marked.Renderer();
            var originalCode = renderer.code;

            renderer.code = function(token) {
                if (token.lang === 'mermaid' && mermaidLoaded) {
                    return '<div class="mermaid">' + token.text + '</div>';
                }
                return '<pre><code>' + escapeHtml(token.text) + '</code></pre>';
            };

            marked.setOptions({ renderer: renderer, breaks: false, gfm: true });

            contentEl.innerHTML = marked.parse(text);

            if (mermaidLoaded) {
                mermaid.run({ nodes: contentEl.querySelectorAll('.mermaid') });
            }
        }

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
